{%- from "components/picture/macro.html" import tnaPicture -%}
{%- from "components/featured-records/macro.html" import tnaFeaturedRecords -%}


{% macro articleBlocks(params, get_wagtail_image) %}
  {% for block in params['blocks'] %}
  <section class="etna-article__section">
    <h2 class="tna-heading-l tna-!--padding-top-s">{{ block['value']['heading'] }}</h2>
    {% for content_item in block['value']['content'] %}
      {% if content_item['type'] == 'paragraph' %}
      {{ content_item['value']['text'] | safe }}

      {% elif content_item['type'] == 'sub_heading' %}
      <h3 class="tna-heading-m">{{ block['value']['heading'] }}</h3>

      {% elif content_item['type'] == 'image' %}
      {% with image=get_wagtail_image(content_item['value']['image']) %}
      {{ tnaPicture({
        'src': "http://localhost:8000" + image['meta']['download_url'],
        'alt': content_item['value']['alt_text'],
        'width': image['width'],
        'height': image['height'],
        'caption': content_item['value']['caption'],
        'transcript': image['transcription'] | tna_html,
        'translation': image['translation']
      }) }}
      {% endwith %}

      {% elif content_item['type'] == 'quote' %}
      <blockquote class="tna-blockquote">
        <div class="tna-blockquote__quote">
          {{ content_item['value']['quote'] | safe }}
        </div>
        <p class="tna-blockquote__author">{{ content_item['value']['attribution'] }}</p>
      </blockquote>

      {% elif content_item['type'] == 'promoted_list' %}
      <h2 class="tna-heading-l">=== TODO: Promoted list ===</h2>

      {% elif content_item['type'] == 'record_links' %}
      {% set items = [] %}
      {% for i in content_item['value']['items'] %}
        {% with image=get_wagtail_image(i['thumbnail_image']) %}
        {{ items.append({
          'imageSrc': image['file'],
          'width': image['width'],
          'height': image['height'],
          'collection': "TS 11/45/167",
          'title': i['descriptive_title'],
          'href': "#",
          'date': i['record_dates']
        }) or "" }}
        {% endwith %}
      {% endfor %}
      {{ tnaFeaturedRecords({
        'items': items
      }) }}

      {% else %}
      <h1 class="tna-heading-xl">======= TODO: {{ content_item['type'] }} =======</h1>
      {% endif %}
    {% endfor %}
  </section>
  {% endfor %}
{% endmacro %}