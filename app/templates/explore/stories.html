{% extends 'explore/base.html' %}

{%- from 'components/card/macro.html' import tnaCard -%}
{%- from 'components/pagination/macro.html' import tnaPagination -%}
{%- from 'macros/feedback.html' import feedback -%}

{% block head %}
{{ super() }}
<link rel="canonical" href="{{ page_data.url | default(request.url) }}?page={{ page }}">
{% endblock %}

{% block content %}
{% if page == 1 %}
<section class="tna-section">
  <div class="tna-container">
    <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny">
      <h1 class="tna-heading-xl">{{ page_data.title }}</h1>
      <div class="tna-large-paragraph tna-!--margin-top-s">
        {{ page_data.intro | safe }}
      </div>
    </div>
  </div>
  <div class="tna-container">
    <div class="tna-column tna-column--full">
      {{ tnaCard({
        'supertitle': featured_article.meta.type | article_supertitle,
        'title': featured_article.title,
        'href': featured_article.meta.html_url,
        'headingLevel': 2,
        'headingSize': 'l',
        'text': featured_article.teaser_text,
        'imageSrc': featured_article.teaser_image_jpg.full_url,
        'imageAlt': featured_article.teaser_image_jpg.alt,
        'imageWidth': featured_article.teaser_image_jpg.width,
        'imageHeight': featured_article.teaser_image_jpg.height,
        'horizontal': True,
        'style': 'accent',
        'htmlElement': 'article',
        'classes': 'tna-!--margin-top-l'
      }) }}
    </div>
  </div>
</section>
{% for featured_page_group in featured_pages %}
<section class="tna-section">
  <div class="tna-container">
    <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny">
      <h2 class="tna-heading-l">{{ featured_page_group.value.heading }}</h2>
      <p class="tna-large-paragraph">{{ featured_page_group.value.description }}</p>
    </div>
  </div>
  <div class="tna-container">
    {% for page in featured_page_group.value['items'] %}
    <div class="tna-column tna-column--width-1-3 tna-column--width-1-2-medium tna-column--width-1-2-small tna-column--full-tiny">
      {% set card_content = {
        'supertitle': page.type_label or None,
        'title': page.title,
        'headingLevel': 3,
        'headingSize': 's',
        'href': page.url,
        'text': page.teaser_text,
        'htmlElement': 'article',
        'classes': 'tna-!--margin-top-l'
      } %}
      {% set card_content = merge_dict_if(card_content, {
        'imageSrc': page.teaser_image_jpeg.full_url,
        'imageAlt': page.teaser_image_jpeg.alt,
        'imageWidth': page.teaser_image_jpeg.width,
        'imageHeight': page.teaser_image_jpeg.height
      }, page.teaser_image_jpeg) %}
      {% set card_content = merge_dict_if(card_content, {
        'label': 'New'
      }, page.is_newly_published) %}
      {{ tnaCard(card_content) }}
    </div>
    {% endfor %}
  </div>
</section>
{% endfor %}
{% endif %}
<section class="tna-section">
  <div class="tna-container">
    <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny">
      {% if page > 1 %}
      <h1 class="tna-heading-xl">Stories from the collection</h1>
      <h2 class="tna-heading-l">Discover all stories, page {{ page }}</h2>
      {% else %}
      <h2 class="tna-heading-l">Discover all stories</h2>
      {% endif %}
      <p class="tna-large-paragraph">Browse and explore the human stories behind The National Archivesâ€™ collection.</p>
    </div>
  </div>
  <div class="tna-container">
    {% for child in children %}
    <div class="tna-column tna-column--width-1-3 tna-column--width-1-2-medium tna-column--width-1-2-small tna-column--full-tiny">
      {{ tnaCard({
        'supertitle': child.meta.type | article_supertitle,
        'title': child.title,
        'headingLevel': 3,
        'headingSize': 's',
        'href': child.meta.html_url,
        'text': child.teaser_text,
        'imageSrc': child.teaser_image_jpg.full_url,
        'imageAlt': child.teaser_image_jpg.alt,
        'imageWidth': child.teaser_image_jpg.width,
        'imageHeight': child.teaser_image_jpg.height,
        'htmlElement': 'article',
        'classes': 'tna-!--margin-top-l'
      }) }}
    </div>
    {% endfor %}
  </div>
  <div class="tna-container">
    <div class="tna-column tna-column--full tna-!--margin-top-xl">
      {{ tnaPagination(pagination) }}
    </div>
  </div>
</section>
{{ feedback() }}
{% endblock %}
