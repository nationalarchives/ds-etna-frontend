{% extends 'explore-the-collection/base.html' %}

{%- from 'explore-the-collection/partials/article-footer.html' import articleFooter -%}
{%- from 'components/button/macro.html' import tnaButton -%}
{%- from 'components/card/macro.html' import tnaCard -%}
{%- from 'components/index-grid/macro.html' import tnaIndexGrid -%}
{%- from 'components/tabs/macro.html' import tnaTabs -%}
{%- from 'components/warning/macro.html' import tnaWarning -%}
{%- from 'macros/feedback.html' import feedback -%}

{%- set themeAccent = 'green' -%}

{% block stylesheets %}
{{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='article.css') }}">
{% endblock %}

{% block content %}
<article>
  <section class="tna-section">
    <div class="tna-container">
      <div class="tna-column tna-column--width-2-3 tna-column--full-small tna-column--full-tiny">
        <hgroup class="tna-hgroup-xl">
          <p class="tna-hgroup__supertitle">{{ page_data.type_label }}</p>
          <h1 class="tna-hgroup__title">{{ page_data.title }}</h1>
        </hgroup>
        <div class="tna-large-paragraph tna-!--margin-top-s">
          {{ page_data.intro | safe }}
        </div>
        {%- if page_data.display_content_warning %}
        {{ tnaWarning({
          'headingLevel': 2,
          'body': page_data.custom_warning_text | safe or 'This article contains content that some people may find offensive.',
          'classes': 'tna-!--margin-top-m'
        }) }}
        {%- endif %}
      </div>
      <div class="tna-column tna-column--width-1-3 tna-!--hide-on-small tna-!--hide-on-tiny etna-tilted-image-wrapper">
        <img src="{{ page_data.intro_image.webp.full_url }}" width="{{ page_data.intro_image.webp.width }}" height="{{ page_data.intro_image.webp.height }}" alt="{{ page_data.intro_image.alt_text }}" class="etna-tilted-image">
      </div>
    </div>
  </section>
  <section class="tna-gallery" data-module="tna-gallery">
    <div class="tna-container tna-visually-hidden">
      <div class="tna-column tna-column--full tna-gallery__header">
        <h2 class="tna-heading-l">
          Images
        </h2>
      </div>
    </div>
    <div class="tna-gallery__items">
      {%- for item in page_data.gallery_items %}
      {% set picture_information = [] %}
      {%- if item.image.transcript %}
      {% set picture_information = picture_information + [{
        'id': 'transcript-' + item.image.id | string,
        'title': item.image.transcript.heading or 'Transcript',
        'body': item.image.transcript.text | tna_html
      }] %}
      {%- endif %}
      {%- if item.image.translation %}
      {% set picture_information = picture_information + [{
        'id': 'translation-' + item.image.id | string,
        'title': item.image.translation.heading or 'Translation',
        'body': item.image.translation.text | tna_html
      }] %}
      {%- endif %}
      <div class="tna-gallery__item tna-container">
        <div class="tna-column tna-column--full tna-gallery__header">
          <p class="tna-gallery__item-index">Image {{ loop.index }} of {{ page_data.gallery_items | length }}</p>
        </div>
        <figure class="tna-gallery__item-figure tna-column {{ 'tna-column--width-2-3' if picture_information | length else 'tna-column--full' }} tna-column--full-medium tna-column--full-small tna-column--full-tiny">
          <img src="{{ item.image.webp.full_url }}" class="tna-gallery__item-image" alt="{{ item.alt_text }}" width="{{ item.image.webp.width }}" height="{{ item.image.webp.height }}">
          {% if item.caption %}
          <figcaption class="tna-gallery__item-description">
            {{ item.caption | safe }}
          </figcaption>
          {% endif %}
        </figure>
        {%- if picture_information | length %}
        <div class="tna-gallery__item-tabs tna-column tna-column--width-1-3 tna-column--full-medium tna-column--full-small tna-column--full-tiny">
          {{ tnaTabs({
            'items': picture_information
          }) }}
        </div>
        {%- endif %}
      </div>
      {%- endfor %}
    </div>
  </section>
  <section class="tna-section">
    <div class="tna-container tna-container--centred">
      <div class="tna-column tna-column--width-2-3 tna-column--width-2-3-medium tna-column--width-3-4-small tna-column--full-tiny">
        <h2 class="tna-heading-l">Why this record matters</h2>
        <dl class="tna-dl tna-dl--plain">
          <dt>Date</dt>
          <dd>{{ page_data.date_text }}</dd>
          {% if page_data.record_data and page_data.record_data.hierarchy | length %}
          {% with parent = page_data.record_data.hierarchy | last %}
          <dt>Catalogue reference</dt>
          <dd>
            <a href="{{ url_for('catalogue.details', id=parent.id) }}">{{ parent.identifier }}</a>
          </dd>
          {% endwith %}
          {% endif %}
        </dl>
        {{ page_data.about | tna_html | safe }}
        <div class="tna-button-group tna-button-group--full">
          {{ tnaButton({
            'text': 'View record details',
            'href': url_for('catalogue.details', id=page_data.record),
            'accent': True
          }) }}
          {% if page_data.image_library_link %}
          {{ tnaButton({
            'text': 'Use this image',
            'href': page_data.image_library_link,
            'accent': True,
            'attributes': {
              'rel': 'noopener noreferrer'
            }
          }) }}
          {% endif %}
          {% if page_data.print_on_demand_link %}
          {{ tnaButton({
            'text': 'Buy an art print',
            'href': page_data.print_on_demand_link,
            'accent': True,
            'attributes': {
              'rel': 'noopener noreferrer'
            }
          }) }}
          {% endif %}
        </div>
      </div>
    </div>
  </section>

  {%- if page_data.featured_highlight_gallery %}
  <section class="tna-section tna-background-accent-light">
    {% set galleries = [] %}
    {%- for gallery in page_data.featured_highlight_gallery.highlight_cards %}
    {%- if loop.index <= 4 %}
    {% set galleries = galleries.append({
      'id': gallery.image.id,
      'title': gallery.image.title,
      'href': page_data.featured_highlight_gallery.url + '#gallery-image-' + (loop.index | string),
      'src': gallery.image.jpeg.full_url,
      'alt': gallery.alt_text,
      'width': gallery.image.jpeg.width,
      'height': gallery.image.jpeg.height
    }) %}
    {%- endif %}
    {%- endfor %}
    {{ tnaIndexGrid({
      'supertitle': page_data.featured_highlight_gallery.type_label,
      'title': 'Explore records about ' + page_data.featured_highlight_gallery.title,
      'body': '<p>' + page_data.featured_highlight_gallery.teaser_text + '</p>',
      'headingLevel': 2,
      'headingSize': 'l',
      'items': galleries,
      'columns': 4,
      'columnsMedium': 2,
      'columnsSmall': 2,
      'columnsTiny': 1
    }) }}
    {%- if page_data.featured_highlight_gallery.highlight_image_count > 4 %}
    <div class="tna-container tna-!--margin-top-m">
      <div class="tna-column tna-column--full">
        <div class="tna-button-group">
          {{ tnaButton({
            'text': 'View all ' + (page_data.featured_highlight_gallery.highlight_image_count | string) + ' images',
            'href': page_data.featured_highlight_gallery.url
          }) }}
        </div>
      </div>
    </div>
    {%- endif %}
  </section>
  {%- endif %}

  {%- for promoted_links in page_data.promoted_links %}
  <section class="tna-section tna-!--padding-bottom-s">
    <div class="tna-container">
      <div class="tna-column tna-column--full">
        <h2 class="tna-heading-l">{{ promoted_links.value.heading }}</h2>
      </div>
    </div>
    <ul class="tna-ul tna-ul--plain tna-container">
      {%- for item in promoted_links.value.promoted_items %}
      <li class="tna-column tna-column--width-1-3 tna-column--width-1-2-medium tna-column--width-1-2-small tna-column--full-tiny">
        {% set meta = [] %}
        {% if item.author %}
        {% set meta = meta + [{ 'title': 'Author', 'text': item.author }] %}
        {% endif %}
        {% if item.publication_date %}
        {% set meta = meta + [{ 'title': 'Published', 'text': item.publication_date }] %}
        {% endif %}
        {{ tnaCard({
          'title': item.title,
          'headingLevel': 3,
          'headingSize': 's',
          'href': item.url,
          'meta': meta,
          'text': item.description,
          'imageSrc': item.teaser_image.jpeg.full_url,
          'imageAlt': item.teaser_image.title,
          'imageWidth': item.teaser_image.jpeg.width,
          'imageHeight': item.teaser_image.jpeg.height,
          'imageSources': [
            {
              'src': item.teaser_image.webp.full_url,
              'type': 'image/webp',
              'width': item.teaser_image.webp.width,
              'height': item.teaser_image.webp.height
            }
          ],
          'lazyImage': True,
          'htmlElement': 'article',
          'classes': 'tna-!--margin-top-s tna-!--margin-bottom-m'
        }) }}
      </li>
      {%- endfor %}
    </ul>
  </section>
  {%- endfor %}

  {{ articleFooter([], categories, []) }}
</article>

{{ feedback() }}
{% endblock %}
